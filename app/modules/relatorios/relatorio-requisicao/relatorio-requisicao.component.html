<div class="header">
  <div class="header-search row align-items-center">
    <div class="col-lg-12">
      <h4 class="title">RELATÓRIO DE REQUISIÇÕES</h4>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-lg-12 align-items-center">
      <div class="form-row justify-content-center" [formGroup]="formFiltro">
        <div class="form-group col-lg-4 required">
          <label for="competencia"> Competência: </label>
          <ng-select
            [items]="tiposCompetencia"
            name="competencia"
            formControlName="competencia"
            clearAllText="Limpar"
            [searchFn]="customSearchCompetencia">
            <ng-template ng-label-tmp let-item="item">
              {{ item | competencia }}
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ item | competencia }}
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-2 required">
          <label for="dataInicio"> Data Início: </label>
          <input
            class="form-control pr-2"
            type="date"
            name="dataInicio"
            formControlName="dataInicio">

        </div>
        <div class="form-group col-lg-2 required">
          <label for="dataFim"> Data Fim: </label>
          <input
            class="form-control pr-2"
            type="date"
            name="dataFim"
            formControlName="dataFim">
        </div>
        <div class="form-group col-lg-4 required">
          <label> Empresas: </label>
          <ng-select
            id="empresas"
            placeholder="Selecione a empresa"
            name="empresas"
            bindValue="idTenant"
            formControlName="empresas"
            clearAllText="Limpar"
            required
            [items]="empresas"
            [loading]="empresasLoading"
            [searchFn]="empresaSearchFn"
            [multiple]="true"
            [clearable]="true"
            [closeOnSelect]="false">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 50%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">
                  {{ item.cnpj }} - {{ item.razaoSocial }}
                </span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">
                  {{ item.cnpj }} - {{ item.razaoSocial }}
                </label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-3">
          <label for="centro"> Status: </label>
          <ng-select
            id="situacaoRequisicaoItem"
            name="situacaoRequisicaoItem"
            bindValue="index"
            formControlName="status"
            clearAllText="Limpar"
            placeholder="Selecione"
            [items]="opcoesSituacaoRequisicaoItem"
            [searchFn]="situacoesSearchFn"
            [multiple]="true"
            [closeOnSelect]="false">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 60%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">
                  {{ item.name }}
                </span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">
                  {{ item.name }}
                </label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-4">
          <label for="responsaveis"> Responsáveis: </label>
          <ng-select
            id="responsaveis"
            name="responsaveis"
            bindValue="idUsuario"
            formControlName="responsaveis"
            clearAllText="Limpar"
            placeholder="Selecione"
            [loading]="usuariosLoading"
            [items]="responsaveis"
            [searchFn]="customSearchUsuario"
            [multiple]="true"
            [clearable]="true"
            [closeOnSelect]="false">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 60%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">
                  {{ item.pessoaFisica.nome }}
                </span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">
                  {{ item.pessoaFisica.nome }}
                </label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-3">
          <label for="solicitantes"> Solicitantes: </label>
          <ng-select
            id="solicitantes"
            name="solicitantes"
            bindValue="idUsuario"
            formControlName="solicitantes"
            clearAllText="Limpar"
            placeholder="Selecione"
            [items]="solicitantes"
            [searchFn]="customSearchUsuario"
            [loading]="usuariosLoading"
            [multiple]="true"
            [clearable]="true"
            [closeOnSelect]="false">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width:60%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">
                  {{ item.pessoaFisica.nome }}
                </span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">
                  {{ item.pessoaFisica.nome }}
                </label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-2">
          <label for="exportar"> </label>
          <button
            class="btn btn-primary btn-block mt-1"
            (click)="downloadRelatorioRequisicoes()">
            <i class="fas fa-download"></i> Exportar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

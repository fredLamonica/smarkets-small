<!-- #region -->
<!-- <ul class="nav bg-gray">
  <li class="nav-item">
    <a> </a>
  </li>
</ul> -->
<div class="header">
  <div class="header-search row align-items-center">
    <div class="col-lg-12">
      <h4 class="title">HISTÓRICO DE APROVAÇÕES</h4>
    </div>
  </div>
</div>
<div class="container">
  <div class="row col-lg-12 align-items-center">
    <div class="form-row">
      <div class="form-group col-12 col-lg-6 col-xl-3">
        <label for="dataInicio"> Período de Aprovação Inicio: </label>
        <input class="form-control" type="date" name="dataInicio" [(ngModel)]="dataInicio" />
      </div>
      <div class="form-group col-12 col-lg-6 col-xl-3">
        <label for="dataFim"> Período de Aprovação Fim: </label>
        <input class="form-control" type="date" name="dataFim" [(ngModel)]="dataFim" />
      </div>

      <div class="form-group col-12 col-lg-6 col-xl-3">
        <label>Aprovadores: </label>
        <ng-select
          class="full-width"
          [multiple]="true"
          [items]="usuarios$ | async"
          bindValue="pessoaFisica.nome"
          [loading]="usuariosLoading"
          [loadingText]="'buscando...'"
          (open)="openUsuarios()"
          [(ngModel)]="nomesAprovadores"
          [closeOnSelect]="false"
          [searchFn]="customSearchAprovador">
          <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
            <div class="ng-value" style="max-width: 60%;" *ngFor="let item of items | slice: 0:1">
              <span class="ng-value-label text-truncate align-middle" style="max-width: 90%;">{{
                item.pessoaFisica.nome
                }}</span>
              <span
                class="ng-value-icon right"
                style="max-width: 10%;"
                (click)="clear(item)"
                aria-hidden="true">×</span>
            </div>
            <div class="ng-value" *ngIf="items.length > 1">
              <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <div class="custom-control custom-checkbox mr-sm-2">
              <input
                type="checkbox"
                class="custom-control-input"
                id="item-{{ index }}"
                [ngModel]="item$.selected" />
              <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                item.pessoaFisica.nome
                }}</label>
            </div>
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group col-12 col-lg-6 col-xl-3">
        <label>Compradores: </label>
        <ng-select
          class="full-width"
          [multiple]="true"
          [items]="compradores$ | async"
          bindValue="pessoaFisica.nome"
          [loading]="compradoresLoading"
          [loadingText]="'buscando...'"
          (open)="listeCompradores()"
          [(ngModel)]="nomesCompradores"
          [closeOnSelect]="false"
          [searchFn]="customSearchCompradores">
          <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
            <div class="ng-value" style="max-width: 60%;" *ngFor="let item of items | slice: 0:1">
              <span class="ng-value-label text-truncate align-middle" style="max-width: 90%;">{{
                item.pessoaFisica.nome
                }}</span>
              <span
                class="ng-value-icon right"
                style="max-width: 10%;"
                (click)="clear(item)"
                aria-hidden="true">×</span>
            </div>
            <div class="ng-value" *ngIf="items.length > 1">
              <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <div class="custom-control custom-checkbox mr-sm-2">
              <input
                type="checkbox"
                class="custom-control-input"
                id="item-{{ index }}"
                [ngModel]="item$.selected" />
              <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                item.pessoaFisica.nome
                }}</label>
            </div>
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group col-12 col-lg-6 col-xl-6">
        <label>Fornecedores: </label>
        <ng-select
          class="full-width"
          [multiple]="true"
          [items]="fornecedores$ | async"
          bindValue="razaoSocial"
          [loading]="fornecedoresLoading"
          [loadingText]="'buscando...'"
          (open)="openFornecedores()"
          [(ngModel)]="nomesFornecedores"
          [closeOnSelect]="false"
          [searchFn]="customSearchFornecedor">
          <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
            <div class="ng-value" style="max-width: 50%;" *ngFor="let item of items | slice: 0:1">
              <span class="ng-value-label text-truncate align-middle" style="max-width: 90%;">{{ item.cnpj }} - {{
                item.razaoSocial }}</span>
              <span
                class="ng-value-icon right"
                style="max-width: 10%;"
                (click)="clear(item)"
                aria-hidden="true">×</span>
            </div>
            <div class="ng-value" *ngIf="items.length > 1">
              <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <div class="custom-control custom-checkbox mr-sm-2">
              <input
                type="checkbox"
                class="custom-control-input"
                id="item-{{ index }}"
                [ngModel]="item$.selected" />
              <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{ item.cnpj }} - {{
                item.razaoSocial }}</label>
            </div>
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group col-12 col-lg-6 col-xl-3">
        <label>Categorias: </label>
        <ng-select
          class="full-width"
          [multiple]="true"
          [items]="categorias$ | async"
          bindValue="nome"
          [loading]="categoriasLoading"
          [loadingText]="'buscando...'"
          (open)="openCategorias()"
          [(ngModel)]="categorias"
          [closeOnSelect]="false"
          [searchFn]="customSearchCategorias">
          <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
            <div class="ng-value" style="max-width: 70%;" *ngFor="let item of items | slice: 0:1">
              <span class="ng-value-label text-truncate align-middle" style="max-width: 90%;">{{
                item.nome
                }}</span>
              <span
                class="ng-value-icon right"
                style="max-width: 10%;"
                (click)="clear(item)"
                aria-hidden="true">×</span>
            </div>
            <div class="ng-value" *ngIf="items.length > 1">
              <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
            </div>
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
            <div class="custom-control custom-checkbox mr-sm-2">
              <input
                type="checkbox"
                class="custom-control-input"
                id="item-{{ index }}"
                [ngModel]="item$.selected" />
              <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                item.nome
                }}</label>
            </div>
          </ng-template>
        </ng-select>
      </div>

      <div class="form-group col-12 col-xl-3 py-4">
        <div class="row">
          <div class="col-lg-6">
            <button class="btn btn-outline-primary btn-block mt-1 mb-2" (click)="montarTabela()">
              <i class="fas fa-filter"></i> Filtrar
            </button>
          </div>

          <div class="col-lg-6">
            <button
              class="btn btn-block btn-primary mt-1"
              (click)="downloadRelatorioHistoricoAprovacao()">
              <i class="fas fa-download"></i> Exportar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- #endregion -->
<div
  class="col-12 my-5 d-flex justify-content-center"
  *ngIf="relatorioPedidosLoading; else hasRelatorioPedidos">
  <div class="spinner spinner-secondary"></div>
</div>
<ng-template #hasRelatorioPedidos>
  <div class="col-12">
    <custom-table
      classes="table-striped table-sm"
      [settings]="settings"
      [source]="pedidosRelatorio">
    </custom-table>
    <pager
      [page]="pagina"
      [total-pages]="totalPaginas"
      [records-per-page]="registrosPorPagina"
      (pagination)="paginacao($event)"></pager>
  </div>
</ng-template>

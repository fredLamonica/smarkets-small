<div class="header">
  <div class="header-search row align-items-center">
    <div class="col-lg-12">
      <h4 class="title">HISTÓRICO DE SOLICITAÇÕES</h4>
    </div>
  </div>
</div>

<div class="container">
  <div class="row" *ngIf="usaIntegracao">
    <div class="col-lg-12 align-items-center">
      <div class="form-row justify-content-center" [formGroup]="formFiltro">
        <div class="form-group col-lg-4">
          <label for="competenciaData"> Competência: </label>
          <ng-select
            [items]="opcoesTipoDataFiltro"
            name="competenciaData"
            formControlName="tipoDataRelatorio"
            [searchFn]="customSearchCompetencia">
            <ng-template ng-label-tmp let-item="item">
              {{ tiposDataRelatorioSolicitacao[item] }}
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ tiposDataRelatorioSolicitacao[item] }}
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-2">
          <label for="dataInicio"> Período Inicio: </label>
          <input class="form-control" type="date" name="dataInicio" formControlName="dataInicio" />
        </div>
        <div class="form-group col-lg-2">
          <label for="dataFim"> Período Fim: </label>
          <input class="form-control" type="date" name="dataFim" formControlName="dataFim" />
        </div>
        <div class="form-group col-lg-4">
          <label> Status </label>
          <ng-select
            id="situacaoSolicitacaoItemCompras"
            [items]="opcoesSituacaoSolicitacaoItemCompra"
            name="situacaoSolicitacaoItemCompras"
            formControlName="situacaoSolicitacaoItemCompras"
            [multiple]="true"
            [closeOnSelect]="false">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 70%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">{{
                  enumSituacaoSolicitacaoItemCompra[item]
                  }}</span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                  enumSituacaoSolicitacaoItemCompra[item]
                  }}</label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-3">
          <label for="centro"> Centro: </label>
          <ng-select
            [items]="filiais$ | async"
            name="codigoFilialEmpresa"
            formControlName="centros"
            bindValue="codigoFilialEmpresa"
            [loading]="filiaisLoading"
            [loadingText]="'buscando...'"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchFn]="customSearchFilial">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 70%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">{{
                  item.codigoFilialEmpresa
                  }}</span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                  item.codigoFilialEmpresa
                  }}</label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-3">
          <label for="categoria"> Categoria: </label>
          <ng-select
            [items]="categorias$ | async"
            bindValue="idCategoriaProduto"
            name="categoria"
            formControlName="categorias"
            [loading]="categoriasLoading"
            [loadingText]="'buscando...'"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchFn]="customSearchCategoria">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 70%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">{{
                  item.nome
                  }}</span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                  item.nome
                  }}</label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-4" *ngIf="tenantSmarkets">
          <label for="unidadeCompradora"> Unidade Compradora: </label>
          <ng-select
            [items]="empresas$ | async"
            bindValue="idTenant"
            name="unidadeCompradora"
            formControlName="idsTenants"
            [loading]="empresasLoading"
            [loadingText]="'buscando...'"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchFn]="customSearchUnidadeCompradora">
            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
              <div class="ng-value" style="max-width: 70%" *ngFor="let item of items | slice: 0:1">
                <span class="ng-value-label text-truncate align-middle" style="max-width: 90%">{{
                  item.razaoSocial
                  }}</span>
                <span
                  class="ng-value-icon right"
                  style="max-width: 10%"
                  (click)="clear(item)"
                  aria-hidden="true">×</span>
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{ items.length - 1 }} mais...</span>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="custom-control custom-checkbox mr-sm-2">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  id="item-{{ index }}"
                  [ngModel]="item$.selected"
                  [ngModelOptions]="{ standalone: true }" />
                <label class="custom-control-label pointer-events-none" for="item-{{ index }}">{{
                  item.razaoSocial
                  }}</label>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="form-group col-lg-2">
          <label for="exportar"> </label>
          <button
            class="btn btn-primary btn-block mt-1"
            (click)="downloadRelatorioPedidosCotacao()">
            <i class="fas fa-download"></i> Exportar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row-3-col">
  <ng-container
    *ngTemplateOutlet=" item?.tipo==TipoCatalogoItem.Catalogo ? catalogo : requisicao">
  </ng-container>
</div>

<!-- #region Catalogo -->
<ng-template #catalogo>
  <div class="card catalogo">
    <div class="container-imagem"
      (click)="exibirDetalhesCatalogo(item.contratoCatalogoItem.idContratoCatalogoItem)">
      <img
        class="imagem"
        [src]="item?.contratoCatalogoItem?.produto?.imagens?.length ? (item?.contratoCatalogoItem?.produto?.imagens)[0].url : './../../../../assets/img/produtos/default.png'"
        [alt]="item?.contratoCatalogoItem?.produto?.descricao | uppercase" />
    </div>
    <ng-container *ngTemplateOutlet="favoritoTmp"></ng-container>
    <div class="card-body p-3">
      <div class="container-descricao">
        <div class="row ">
          <div class="col">
            <span
              class="mb-0 descricao font-weight-bold d-block text-uppercase"
              data-toggle="tooltip"
              data-placement="bottom"
              [title]="item?.contratoCatalogoItem?.produto?.descricao | uppercase"
              (click)="exibirDetalhesCatalogo(item.contratoCatalogoItem.idContratoCatalogoItem)"
              role="button">
              {{ item?.contratoCatalogoItem?.produto?.descricao | slice:0:80}}
              {{ item?.contratoCatalogoItem?.produto?.descricao.length > 80 ? '...' : ''}}

            </span>
          </div>
        </div>
      </div>
      <div class="row mb-1">
        <div class="col">
          <span class="badge"
            [ngClass]="item.contratoCatalogoItem.tipoCatalogo === TipoCatalogo['Catálogo Smarkets'] ? 'badge-primary badge-strong' : 'badge-success font-weight-bold'">
            {{TipoCatalogo[item.contratoCatalogoItem.tipoCatalogo]}}
          </span>
        </div>
      </div>
      <div class="row">
        <div class="marca col text-truncate">
          <span>Marca:</span>
          <span
            class="text-uppercase"
            [title]="item?.contratoCatalogoItem?.marca ? item.contratoCatalogoItem.marca.nome : 'Sem preferência' | uppercase">
            {{ item?.contratoCatalogoItem?.marca ? item.contratoCatalogoItem.marca.nome : 'Sem preferência' }}
          </span>
        </div>
      </div>
      <div class="row mb-3">
        <div
          class="col text-truncate text-uppercase"
          [title]="item?.contratoCatalogoItem?.fornecedor?.cnpj + ' - ' + item?.contratoCatalogoItem?.fornecedor?.razaoSocial | uppercase">
          {{ item?.contratoCatalogoItem?.fornecedor?.razaoSocial }}
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <h3 class="mb-0 valor font-weight-bold ">
            {{ item?.contratoCatalogoItem?.valor | customCurrency: item?.contratoCatalogoItem?.moeda:null:'symbol' }}
          </h3>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col align-content-center">
          <p class="mb-0">Mín.|Qtde.</p>
          <input-number-min-value
            [class.invalid]="!quantidade || quantidade > maxQuant || quantidade < item.contratoCatalogoItem?.loteMinimo"
            [(ngModel)]="quantidade"
            [min]="item.contratoCatalogoItem?.loteMinimo"
            [max]="maxQuant"
            [allowDecimal]="item?.contratoCatalogoItem?.produto?.unidadeMedida?.permiteQuantidadeFracionada">
          </input-number-min-value>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <p class="mb-0">
            Un. de Medida: {{ item.contratoCatalogoItem?.produto?.unidadeMedida?.sigla }}
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <p class="mb-0">
            Frete: {{ TipoFrete[item?.contratoCatalogoItem?.frete].toUpperCase() }}
            <button
              type="button"
              class="btn btn-icon btn-sm p-0"
              [ngbTooltip]="tipContent"
              placement="top"
              tooltipClass="tooltip-light tooltip-estados-atendimento">
              <i class="icone-estados-atendimento fas fa-info-circle"></i>
            </button>
          </p>
        </div>
        <div class="col text-right">
          <p class="mb-0">{{ prazoEntrega(item) }}</p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <p class="mb-0">
            Faturamento Mínimo
            <button
              type="button"
              class="btn btn-icon btn-sm p-0"
              [ngbTooltip]="faturamentoTipContent"
              placement="top"
              tooltipClass="tooltip-light tooltip-estados-atendimento">
              <i class="icone-estados-atendimento fas fa-info-circle"></i>
            </button>
          </p>
        </div>
      </div>
    </div>
    <div class="card-footer pt-0 px-3 pb-3">
      <button
        class="adicionar-carrinho btn btn-block"
        (click)="solicitarAdicaoNoCarrinho()"
        data-toggle="tooltip"
        data-placement="bottom"
        title="Adicionar ao carrinho.">
        <p class="font-weight-bold text-white m-0">Adicionar ao carrinho</p>
      </button>
    </div>
  </div>
</ng-template>
<ng-template #tipContent>
  <div style="text-align: left">
    <strong>Estados de Atendimento:</strong>
    <p
      *ngIf="!item?.contratoCatalogoItem?.estadosItem || item?.contratoCatalogoItem?.estadosItem.length === 0">
      Nenhum estado definido
    </p>
    <div *ngFor="let estadosItem of item?.contratoCatalogoItem?.estadosItem">
      <span class="abreviacao-estado">{{ estadosItem.estado.abreviacao }}:&nbsp;</span>
      <strong>
        {{ estadosItem.prazoEntregaDias }}&nbsp;
        {{ (estadosItem.prazoEntregaDias > 1 ? 'dias úteis' : 'dia útil') }}
      </strong>
    </div>
  </div>
</ng-template>
<ng-template #faturamentoTipContent>
  <div style="text-align: left">
    <strong>Estados de Atendimento:</strong>
    <p
      *ngIf="!item?.contratoCatalogoItem?.faturamento || item?.contratoCatalogoItem?.faturamento.length === 0">
      Nenhum estado definido
    </p>
    <div *ngFor="let faturamento of item?.contratoCatalogoItem?.faturamento">
      <span class="abreviacao-estado">{{ faturamento.estado.abreviacao }}:&nbsp;</span>
      <strong>
        {{ faturamento.valorMinimoPedido | customCurrency: item?.contratoCatalogoItem?.moeda:null:'symbol' }};
      </strong>
    </div>
  </div>
</ng-template>
<!-- #endregion -->

<!-- #region Requisição -->
<ng-template #requisicao>
  <div class="card requisicao">
    <div class="container-imagem" (click)="exibirDetalhesRequisicao(item?.produto?.idProduto)">
      <img
        class="imagem"
        [src]="item?.produto?.imagens?.length ? (item?.produto?.imagens)[0].url : './../../../../assets/img/produtos/default.png'"
        [alt]="item?.produto?.descricao | uppercase" />
    </div>
    <ng-container *ngTemplateOutlet="favoritoTmp"></ng-container>
    <div class="card-body p-3">
      <div class="row mb-3">
        <div class="col">
          <span
            class="mb-0 descricao font-weight-bold d-block text-uppercase"
            data-toggle="tooltip"
            data-placement="bottom"
            [title]="item?.produto?.descricao | uppercase"
            (click)="exibirDetalhesRequisicao(item?.produto?.idProduto)"
            role="button">
            {{ item?.produto?.descricao | slice:0:80}}
            {{ item?.produto?.descricao.length > 80 ? '...' : ''}}
          </span>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <h3
            class="mb-0 valor font-weight-bold"
            *ngIf="item?.produto?.valorReferencia != null">
            {{ item?.produto?.valorReferencia | customCurrency: item?.produto?.moeda:null:'symbol' }}
          </h3>
          <h3 class="mb-0 valor font-weight-bold "
            *ngIf="item?.produto?.valorReferencia == null">
            {{ 0.0 | customCurrency: item?.produto?.moeda:null:'symbol' }}
          </h3>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <p class="mb-0">Mín.|Qtde.</p>
          <input-number-min-value
            [class.invalid]="!quantidade || quantidade > maxQuant || quantidade < 1"
            [(ngModel)]="quantidade"
            [min]="1"
            [max]="maxQuant"
            [allowDecimal]="item?.produto?.unidadeMedida?.permiteQuantidadeFracionada"></input-number-min-value>
        </div>
      </div>
      <div class="row align-items-center">
        <div class="col">
          <p class="mb-lg-0">SLA de Atendimento</p>
        </div>
        <div class="col text-right">
          <p class="mb-0">{{ item?.prazoSLA != 1 ? item?.prazoSLA + ' dias úteis' : item?.prazoSLA + ' dia útil' }}</p>
        </div>
      </div>
    </div>
    <div class="card-footer pt-0 px-3 pb-3">
      <button
        class="adicionar-carrinho btn btn-block"
        (click)="solicitarAdicionarCarrinhoRequisicao()"
        data-toggle="tooltip"
        data-placement="bottom"
        title="Adicionar ao carrinho.">
        <p class="font-weight-bold text-white m-0">Adicionar ao carrinho</p>
      </button>
    </div>
  </div>
</ng-template>
<!-- #endregion  -->

<ng-template #favoritoTmp>
  <i
    class="fas fa-heart icone-favorito"
    [class.marcado]="item.idProdutoFavorito"
    (click)="adicionarFavorito()">
  </i>
</ng-template>
